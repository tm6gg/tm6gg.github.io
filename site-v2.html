<body>
    <div id="notification" class="notification scale-0">
        <div>
            <span id="notificationText"></span>
        </div>
    </div>

    <div id="content" class="flex flex-col h-screen transition-all">
        <div class="text-center m-auto mb-0">
            <div>
                <div class="dark:bg-slate-800 bg-slate-200 p-1 rounded w-[264px]">
                    <div class="grid gap-1 grid-cols-2 grid-rows-1">
                        <div>
                            <img id="cover" src="PR-logo-design-Graphics-31862184-1 (1).jpg"
                                class="h-32 w-32 rounded shadow float-right" onerror="this.src='https://cdn.temperrrr.uk/r/LogisticHaul_ATS_TMP.png'" />
                        </div>
                        <div>
                            <img id="presenterAvatar" src="Screenshot_2024-12-25_121634.webp"
                                class="h-32 w-32 rounded" onerror="this.src='https://f.tem6.org.uk/r/Temperrrr.png'" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Now Playing section moved below the images -->
        <div class="mt-4 text-center">
            <p class="text-xl font-semibold" id="nowPlaying">Now Playing: <span id="streamTitle">Loading...</span></p>
        </div>

        <!-- Request Song button -->
        <div class="mt-2 text-center">
            <p>
                <span class="font-bold"><a href="javascript:void(0)" id="openRequestButton" style="color: #ff5733; font-size: 20px;">Request Song</a></span>
            </p>
        </div>

        <div class="mt-2 text-center">
            <p>
                <span class="font-bold"><a href="https://discord.gg/anKpgvGWMX">Discord</a></span>
            </p>
            <p>
                <span class="font-bold"><a href="https://twitter.com/tm6_gg">Created with ❤️ by tm6</a></span>
            </p>
            <p>
                <span class="font-bold"><a href="https://paradox-radio.me">Discord Bot (soon)</a></span>
            </p>
            <p>
                <span class="font-bold"><a href="https://paradox-radio.me">Status: </span><span id="presenter">Good </span>
            </p>
            <p>
                <span class="font-bold">Version: </span><span id="presenter">1.6 - Critical Fixes, <b>Added new request system</b>! try it!</span>
            </p>
        </div>
    </div>

    <!-- Request Popup -->
    <div id="popupOverlay">
        <div id="requestPopup">
            <h2>Request a Song</h2>
            <input type="text" id="songTitle" placeholder="Enter song title" />
            <input type="text" id="songArtist" placeholder="Enter artist name" />
            <input type="text" id="userName" placeholder="Enter your name" />
            <textarea id="userMessage" placeholder="Message (optional)" rows="3"></textarea>
            <button id="sendRequestButton">Send Request</button>
            <button id="closePopupButton">Close</button>
        </div>
    </div>

    <audio id="stream" src="https://stream.zeno.fm/jw92zlb8aobvv" preload="auto"></audio>

    <script>
        // Webhook URL (Replace with your actual webhook URL)
        const webhookURL = 'https://discord.com/api/webhooks/1322520664724475904/drfeaf92iZSHpEptInUYhzVv99-pyX7xz7mrNjy86PJfpP3G3rTAc0ToBm1NVASPeHyc';

        // Function to update the stream title dynamically
        function updateStreamTitle(title) {
            document.getElementById('streamTitle').innerText = title || 'No song playing';
        }

        // Fetch and handle incoming API data for the song title
        const eventSource = new EventSource("https://api.zeno.fm/mounts/metadata/subscribe/jw92zlb8aobvv");
        eventSource.onmessage = function (event) {
            const data = JSON.parse(event.data);
            if (data && data.streamTitle) {
                updateStreamTitle(data.streamTitle);
            } else {
                console.error('Invalid data:', event.data);
            }
        };

        eventSource.onerror = function (error) {
            console.error('EventSource failed:', error);
        };

        // Open request popup when the "Request Song" button is clicked
        document.getElementById("openRequestButton").addEventListener("click", function () {
            document.getElementById("popupOverlay").style.display = "flex";
        });

        // Close the popup when the "Close" button is clicked
        document.getElementById("closePopupButton").addEventListener("click", function () {
            document.getElementById("popupOverlay").style.display = "none";
        });

        // Handle the send request button click
        document.getElementById("sendRequestButton").addEventListener("click", function () {
            const title = document.getElementById("songTitle").value;
            const artist = document.getElementById("songArtist").value;
            const userName = document.getElementById("userName").value;
            const userMessage = document.getElementById("userMessage").value;

            if (title && artist && userName) {
                // Create the embed for Discord
                const embed = {
                    title: "New Song Request",
                    color: 16711680, // Red color
                    fields: [
                        {
                            name: "Song Title",
                            value: title
                        },
                        {
                            name: "Artist",
                            value: artist
                        },
                        {
                            name: "Requested by",
                            value: userName
                        },
                        {
                            name: "Message",
                            value: userMessage || "No message provided"
                        }
                    ],
                    footer: {
                        text: "Paradox Radio - Powered by tm6"
                    }
                };

                // Send the request to Discord webhook
                fetch(webhookURL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ embeds: [embed] })
                })
                .then(response => {
                    if (response.ok) {
                        alert("Your song request has been sent!");
                        document.getElementById("popupOverlay").style.display = "none";
                    } else {
                        alert("There was an error sending your request.");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("There was an error sending your request.");
                });
            } else {
                alert("Please fill in all required fields.");
            }
        });
    </script>
</body>
